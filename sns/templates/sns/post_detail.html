{% extends 'base.html' %}

{% block extra_style %}
    <style>
        .good, .good:focus, .good:hover {
            border: none;
            outline: none;
            background: none;
        }
        .w-125px {
                width: 125px !important;
            }
        .h-34px {
            height: 34px !important;
        }
        .notlink{
            text-decoration:none !important;
            color:black !important;
        }
        .block:hover{
            background:#ddd;
        }
        .wh-30px{
            width: 35px !important;
            height: 35px !important;
            border-radius:50%;
        }
        .wh-30px:hover{
            background: #ccc;
            border-radius:50%;
        }
        .wh-30px:focus{
            background: #aaa;
            border-radius:50%;
        }
        .notlink{
            text-decoration:none !important;
            color:black !important;
        }
    </style>
{% endblock %}

{% block content %}
    <div>
        {% if is_block %}
            <br>
            <br>
            <h1 style="color:red; text-align:center;">ブロック中のユーザーの投稿<h1>
        {% elif is_blocked %}
            <br>
            <br>
            <h4 style="text-align:center;">この投稿をしたユーザーは投稿の公開を制限しています<h4>
        {% else %}
            {% comment %} ブロックしていないとき {% endcomment %}
            <div>
                <h5>
                    <a href='{% url "accounts:user" post.author.id %}' style="text-align:left">
                        {{ post.author }}
                    </a>
                </h5>
                {% comment %} 削除と編集のボタン {% endcomment %}
                {% if request.user.id == object.author_id %}
                    <div class="dropdown" style="float:right;">
                        <button class="wh-30px float-right dropdown-toggle" type="button"
                            id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fa-solid fa-ellipsis-vertical"></i>
                        </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item block" href="{% url 'sns:update' post.pk %}" style="color:green">編集</a>
                                <a class="dropdown-item block" href="{% url 'sns:delete' post.pk %}" style="color:red">削除</a>
                            </div>
                    </div>
                {% endif %}

                <div>
                    <h3 style="text-align:center">
                        {{ post.title }}
                    </h3>
                    <div style="text-align:right">
                        {{ post.created_at }}
                    </div>
                    <hr width="100%" color="#ddd">
                    <br>
                    <div style="padding-left:5rem;">
                        {{ post.detail | linebreaks }}
                    </div>
                    <br>
                    <hr width="100%" color="#ddd">
                </div>

                {% comment %} コメントボタン {% endcomment %}
                <p style="float:left">
                    コメントする:
                    <a href="{% url 'sns:comment' post.id %}" class="notlink">
                        <i class="fa-solid fa-comment"></i>
                    </a>
                </p>

                {% comment %} イイねボタン {% endcomment %}
                <p style="text-align:right;">
                    {% if request.user.is_anonymous %}
                        <button onClick="location.href='{% url 'sns:good' post.id 0 %}'" class="good">
                            <i class="fa-regular fa-heart"></i>
                        </button>
                    {% else %}
                        <button id="ajax-good" class="good">
                            <div class="result">
                                {% if goods %}
                                    <i class="fa-solid fa-heart" style="color: #ff0000;"></i>
                                {% else %}
                                    <i class="fa-regular fa-heart"></i>
                                {% endif %}
                            </div>
                        </button>
                    {% endif %}
                    <a href="{% url 'sns:good_user' post.id %}" class="notlink">
                    : <span class="num">{{ post.good_num }}</span> イイね
                    </a>
                </p>

                <hr widht="100%" color="#ddd">
                <hr widht="100%" color="#ddd" height="4px">

                {% comment %} コメント一覧 {% endcomment %}
                <br>
                <h5 style="text-align:center">コメント</h5>
                <br>
                {% with posts_include=comments good_mode="1" othergood="1"%}
                    <div class="mx-auto">
                        {% include 'post_list_include.html' %}
                    </div>
                {% endwith %}
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_ajax %}
    let myid;
    $('#ajax-good').on('click', function(e) {
        e.preventDefault();
        $.ajax({
            'url': '{% url "sns:ajaxgood" %}',
            'type': 'POST',
            'data': {
                'post_id': '{{ post.id }}',
            },
            'dataType': 'json'
        })
        .done(function(response){
            if (response.method == "create"){
                $('.result').html('<i class="fa-solid fa-heart fa-beat" style="color: #ff0000;"></i>');
                myid = setTimeout(function(){
                    $('.result').html('<i class="fa-solid fa-heart" style="color: #ff0000;"></i>');
                }, 1000)
            }else{
                $('.result').html('<i class="fa-regular fa-heart"></i>');
                clearTimeout(myid)
            }
            $('.num').html(response.num);
        });
    });
{% endblock %}